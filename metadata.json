import os
import json
import subprocess
from datetime import datetime

# Path to your JSON file
json_file_path = 'images.json'

# Function to get the list of new image files
def get_new_images():
    result = subprocess.run(['git', 'diff', '--name-only', '--diff-filter=A', 'HEAD~1..HEAD'], stdout=subprocess.PIPE)
    new_files = result.stdout.decode('utf-8').split('\n')
    new_images = [f for f in new_files if f.lower().endswith(('.png', '.jpg', '.jpeg', '.gif'))]
    return new_images

# Function to update the JSON file
def update_json_file(new_images):
    if os.path.exists(json_file_path):
        with open(json_file_path, 'r') as f:
            data = json.load(f)
    else:
        data = []

    for image in new_images:
        image_info = {
            "file": image,
            "name": os.path.basename(image),
            "date": datetime.now().strftime('%d/%m/%y')
        }
        data.append(image_info)

    with open(json_file_path, 'w') as f:
        json.dump(data, f, indent=2)

def main():
    new_images = get_new_images()
    if new_images:
        update_json_file(new_images)

if __name__ == "__main__":
    main()
